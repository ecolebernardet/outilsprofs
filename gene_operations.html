<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rituel Op√©rations - Expert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        
        :root {
            --bg-page: #121212; --card-bg: #1e1e1e; --text-main: #ffffff;
            --column-border: rgba(255, 255, 255, 0.1); --input-bg: #2a2a2a;
            --accent-color: #f59e0b; --shadow-custom: 0 10px 25px -5px rgba(0, 0, 0, 0.4);
        }

        body.light-mode {
            --bg-page: #f3f4f6; --card-bg: #ffffff; --text-main: #111827;
            --column-border: rgba(0, 0, 0, 0.1); --input-bg: #f9fafb;
            --shadow-custom: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-page); color: var(--text-main); margin: 0; padding: 0; transition: all 0.3s ease; }
        
        header { 
            background: var(--card-bg); border-bottom: 1px solid var(--column-border);
            position: sticky; top: 0; z-index: 100; display: flex; align-items: center;
            justify-content: space-between; padding: calc(env(safe-area-inset-top) + 10px) 15px 10px 15px; 
            width: 100%; margin-bottom: 12px;
        }

        .ui-btn-round { width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; border-radius: 50%; flex-shrink: 0; transition: all 0.2s ease; cursor: pointer; border: none; background: var(--accent-color); color: #000; }
        header h1 { font-size: 1.125rem; font-weight: 900; text-transform: uppercase; text-align: center; flex-grow: 1; }

        .main-wrapper { width: 100%; max-width: 450px; margin: 0 auto; padding: 1px 15px 40px; transition: max-width 0.3s ease; }
        .light-card { background: var(--card-bg); border-radius: 1.5rem; padding: 15px; border: 1px solid var(--column-border); box-shadow: var(--shadow-custom); margin-bottom: 15px; }
        
        .input-field { background: var(--input-bg); border: 1px solid var(--column-border); border-radius: 0.75rem; padding: 10px; font-size: 0.85rem; font-weight: 700; width: 100%; color: var(--text-main); outline: none; text-align: center; }
        
        .btn-add { width: 100%; padding: 14px; border-radius: 50px; font-weight: 900; font-size: 12px; text-transform: uppercase; border: none; cursor: pointer; transition: transform 0.1s; background: var(--accent-color); color: #000; }

        .day-box { background: rgba(122,122,122,0.05); border-radius: 1rem; padding: 8px; border: 1px solid var(--column-border); }
        
        .q-card { background: var(--card-bg); border-radius: 0.75rem; padding: 12px; border: 1px solid var(--column-border); display: flex; justify-content: space-between; align-items: center; }
        .res-text { color: #10b981; font-weight: 800; }

        .modal-overlay { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--card-bg); width: 100%; max-width: 400px; border-radius: 1.5rem; border: 1px solid var(--column-border); padding: 25px; position: relative; color: var(--text-main); }

        /* Styles Seyes PDF */
        .seyes-container { position: relative; height: 48mm; width: 100%; background: white; border: 1px solid #cbd5e1; overflow: hidden; box-sizing: border-box; }
        .seyes-vertical-lines { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: linear-gradient(90deg, rgba(173, 216, 230, 1) 1px, transparent 1px); background-size: 8mm 100%; z-index: 1; }
        .seyes-line { position: absolute; left: 0; right: 0; height: 1px; z-index: 2; }
        .line-principale { background: rgba(138, 43, 226, 0.4); height: 1.5px; }
        .line-interligne { background: rgba(173, 216, 230, 1); }

        @media (min-width: 1024px) {
            .main-wrapper { max-width: 950px; }
            #setup-zone:not(.hidden) { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start; }
            #setup-zone .light-card { margin-bottom: 0; height: 100%; }
            #setup-zone > button.btn-add { grid-column: span 2; margin-top: 10px; font-size: 14px; }
            #questions-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
            #questions-grid .col-span-full { grid-column: span 2; font-size: 12px; margin-top: 30px; }
            .q-card span.text-[13px] { font-size: 1.1rem; }
            .res-text { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

<script>
    // Appliquer le mode clair d√®s le d√©but du chargement
    if (localStorage.getItem('theme_mode') === 'light') {
        document.body.classList.add('light-mode');
    }
</script>

<header>
    <a href="index.html" id="btn-retour-header" class="ui-btn-round active:scale-90">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" /></svg>
    </a>
    <h1>Rituel Op√©rations</h1>
    <button id="btn-aide" onclick="ouvrirAide()" class="ui-btn-round active:scale-90 text-lg">üí°</button>
</header>

<div class="main-wrapper">
    <div class="mb-4">
        <a href="generateurs.html" id="btn-retour-liste" class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-[10px] font-black uppercase transition-transform active:scale-95 shadow-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M15 19l-7-7 7-7" />
            </svg>
            Retour aux g√©n√©rateurs
        </a>
    </div>

    <div id="setup-zone" class="space-y-4">
        <div class="space-y-4">
            <div class="light-card">
                <label class="block text-[10px] font-black uppercase opacity-60 mb-3 tracking-widest text-center">1. Niveau Scolaire</label>
                <select id="niveau-select" class="input-field" onchange="appliquerPresetsNiveau()">
                    <option value="cp">CP</option>
                    <option value="ce1">CE1</option>
                    <option value="ce2">CE2</option>
                    <option value="cm1">CM1</option>
                    <option value="cm2" selected>CM2</option>
                </select>
            </div>

            <div class="light-card">
                <label class="block text-[10px] font-black uppercase opacity-60 mb-4 tracking-widest text-center">2. Quantit√© par jour (Total 4)</label>
                <div id="days-container" class="grid grid-cols-1 gap-3"></div>
            </div>
        </div>

        <div class="light-card space-y-5">
            <label class="block text-[10px] font-black uppercase opacity-60 mb-2 tracking-widest text-center">3. R√©glages des termes</label>
            <div id="group-settings-retenues" class="p-3 bg-white/5 rounded-2xl border border-white/5 text-center mb-2 space-y-2">
                <label class="flex items-center justify-center gap-3 cursor-pointer">
                    <input type="checkbox" id="add-sans-retenues" class="w-4 h-4 accent-[var(--accent-color)]">
                    <span class="text-[10px] font-black uppercase opacity-60 tracking-widest">Additions sans retenues</span>
                </label>
                <label class="flex items-center justify-center gap-3 cursor-pointer">
                    <input type="checkbox" id="sub-sans-retenues" class="w-4 h-4 accent-[var(--accent-color)]">
                    <span class="text-[10px] font-black uppercase opacity-60 tracking-widest">Soustractions sans retenues</span>
                </label>
            </div>

            <div id="group-settings-as" class="space-y-3 p-3 bg-white/5 rounded-2xl border border-white/5 text-center">
                <span class="block text-[9px] font-black opacity-30 uppercase">Additions & Soustractions</span>
                <div class="flex gap-3">
                    <div class="flex-1"><label class="block text-[8px] opacity-50 mb-1">Mini</label><input type="number" id="as-min" class="input-field"></div>
                    <div class="flex-1"><label class="block text-[8px] opacity-50 mb-1">Maxi</label><input type="number" id="as-max" class="input-field"></div>
                </div>
            </div>
            <div id="group-settings-mult" class="space-y-3 p-3 bg-white/5 rounded-2xl border border-white/5 text-center">
                <span class="block text-[9px] font-black opacity-30 uppercase">Multiplications</span>
                <div class="flex gap-3">
                    <div class="flex-1"><label class="block text-[8px] opacity-50 mb-1">Chiffres T1</label><input type="number" id="mult-t1" class="input-field"></div>
                    <div class="flex-1"><label class="block text-[8px] opacity-50 mb-1">Chiffres T2</label><input type="number" id="mult-t2" class="input-field"></div>
                </div>
            </div>
            <div id="group-settings-div" class="space-y-3 p-3 bg-white/5 rounded-2xl border border-white/5 text-center">
                <span class="block text-[9px] font-black opacity-30 uppercase">Divisions</span>
                <div class="flex gap-3">
                    <div class="flex-1"><label class="block text-[8px] opacity-50 mb-1">Chiffres Dividende</label><input type="number" id="div-t1" class="input-field"></div>
                    <div class="flex-1"><label class="block text-[8px] opacity-50 mb-1">Diviseur Max</label><input type="number" id="div-t2" class="input-field"></div>
                </div>
            </div>
        </div>
        <button onclick="genererRituel()" class="btn-add" id="btn-generer-main">G√©n√©rer la semaine</button>
    </div>

    <div id="result-zone" class="hidden space-y-4">
        <div id="questions-grid"></div>
        <div class="grid grid-cols-2 gap-3 pt-6">
            <button onclick="retourConfiguration()" class="flex items-center justify-center gap-2 py-3 rounded-3xl text-[10px] font-black uppercase tracking-widest bg-gray-500/10 border border-gray-500/20 text-gray-500 hover:bg-gray-500/20 transition-all active:scale-95">Configuration</button>
            <button onclick="exportPDF()" class="btn-add flex items-center justify-center gap-2 shadow-lg shadow-[var(--accent-color)]/20" id="btn-export">Exporter PDF</button>
            <button onclick="toggleCorrection()" class="col-span-2 flex items-center justify-center gap-2 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest bg-emerald-500/10 border border-emerald-500/20 text-emerald-500 hover:bg-emerald-500/20 transition-all active:scale-95">Afficher la correction</button>
        </div>
    </div>
</div>

<div id="modal-aide" class="modal-overlay" onclick="fermerAide()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 class="text-lg font-black uppercase mb-4 text-center" id="titre-aide">üí° Guide du Rituel</h2>
        
        <div class="text-[11px] leading-relaxed space-y-4 opacity-90">
            <div>
                <p class="font-bold uppercase text-[9px] mb-1 text-[var(--accent-color)]">1. Configuration</p>
                <p>Choisissez le <b>niveau scolaire</b> pour appliquer les pr√©r√©glages (difficult√© des nombres). Ajustez ensuite le nombre de calculs par jour via les compteurs (max 4 par jour).</p>
            </div>

            <div>
                <p class="font-bold uppercase text-[9px] mb-1 text-[var(--accent-color)]">2. R√©glages Avanc√©s</p>
                <p>D√©finissez le nombre de chiffres pour chaque terme. Pour les plus petits, cochez <b>"Sans retenues"</b> pour simplifier les op√©rations.</p>
            </div>

            <div>
                <p class="font-bold uppercase text-[9px] mb-1 text-[var(--accent-color)]">3. G√©n√©ration & PDF</p>
                <p>Une fois la semaine g√©n√©r√©e, vous pouvez v√©rifier les r√©sultats avec <b>"Afficher la correction"</b>. L'export PDF cr√©era automatiquement deux pages : les exercices sur <b>Seyes</b> et la correction.</p>
            </div>

            <div class="bg-black/5 p-2 rounded-lg border border-white/5 italic">
                Note : Par d√©faut, le syst√®me g√©n√®re 4 calculs par jour, soit 16 calculs sur la semaine.
            </div>
        </div>

        <button id="btn-fermer-aide" onclick="fermerAide()" class="mt-6 w-full py-3 rounded-xl text-[10px] font-black uppercase tracking-widest active:scale-95 transition-transform">J'ai compris</button>
    </div>
</div>

<script>
    const jours = ["Lundi", "Mardi", "Jeudi", "Vendredi"];
    const ops = [{id:'add', label:'+', color:'#60a5fa'}, {id:'sub', label:'-', color:'#f87171'}, {id:'mul', label:'x', color:'#fbbf24'}, {id:'div', label:'√∑', color:'#a78bfa'}];

    function init() {
        const container = document.getElementById('days-container');
        const niv = document.getElementById('niveau-select').value;
        container.innerHTML = ''; 
        jours.forEach((j, dayIdx) => {
            let html = `<div class="day-box"><div class="text-[10px] font-black mb-3 opacity-60 uppercase text-center">${j}</div><div class="flex justify-around items-center">`;
            ops.forEach((op) => {
                if (niv === 'cp' && (op.id === 'mul' || op.id === 'div')) return;
                if (niv === 'ce1' && op.id === 'div') return;
                let val = 1;
                html += `<div class="counter-group flex flex-col items-center">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mb-2" style="background:${op.color}20; border:1.5px solid ${op.color}"><span class="text-lg font-black" style="color:${op.color}">${op.label}</span></div>
                    <div class="flex flex-col items-center bg-black/5 rounded-xl p-1 border border-black/5">
                        <button onclick="changeVal(${dayIdx},'${op.id}',1)" class="w-9 h-7 flex items-center justify-center opacity-50 hover:opacity-100" style="color:var(--accent-color)"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4"><path d="M5 15l7-7 7 7"/></svg></button>
                        <div id="cnt-${dayIdx}-${op.id}" class="w-9 h-6 flex items-center justify-center font-black text-sm text-[var(--accent-color)]">${val}</div>
                        <button onclick="changeVal(${dayIdx},'${op.id}',-1)" class="w-9 h-7 flex items-center justify-center opacity-50 hover:opacity-100" style="color:var(--accent-color)"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4"><path d="M19 9l-7 7-7-7"/></svg></button>
                        <input type="hidden" data-day="${dayIdx}" data-op="${op.id}" data-day-name="${j}" value="${val}">
                    </div>
                </div>`;
            });
            container.innerHTML += html + `</div></div>`;
        });
        appliquerTheme();
    }

    function changeVal(dayIdx, opId, delta) {
        const input = document.querySelector(`input[data-day="${dayIdx}"][data-op="${opId}"]`);
        const display = document.getElementById(`cnt-${dayIdx}-${opId}`);
        const total = Array.from(document.querySelectorAll(`input[data-day="${dayIdx}"]`)).reduce((a, b) => a + (parseInt(b.value)||0), 0);
        let newVal = (parseInt(input.value)||0) + delta;
        if (newVal < 0 || (delta > 0 && total >= 4)) return;
        input.value = newVal; if(display) display.innerText = newVal;
    }

    function appliquerPresetsNiveau() {
        const niv = document.getElementById('niveau-select').value;
        const config = { 'cp':[1,50,1,1,1,2], 'ce1':[10,99,1,1,1,5], 'ce2':[100,9999,2,1,2,9], 'cm1':[1000,99999,3,2,3,9], 'cm2':[1000,999999,3,2,4,15] };
        const p = config[niv];
        ['as-min','as-max','mult-t1','mult-t2','div-t1','div-t2'].forEach((id,i) => document.getElementById(id).value = p[i]);
        document.getElementById('group-settings-mult').style.display = (niv==='cp')?'none':'block';
        document.getElementById('group-settings-div').style.display = (niv==='cp'||niv==='ce1')?'none':'block';
        init();
    }

    function getRandomNDigits(n) { const min=Math.pow(10,n-1), max=Math.pow(10,n)-1; return Math.floor(Math.random()*(max-min+1))+min; }

    function checkSansRetenue(a, b, type) {
        let sA = a.toString(), sB = b.toString();
        let len = Math.max(sA.length, sB.length);
        sA = sA.padStart(len, '0'); sB = sB.padStart(len, '0');
        if (type === 'add') { for(let k=0; k<len; k++) { if (parseInt(sA[k]) + parseInt(sB[k]) > 9) return false; } }
        else if (type === 'sub') { for(let k=0; k<len; k++) { if (parseInt(sA[k]) < parseInt(sB[k])) return false; } }
        return true;
    }

    function genererRituel() {
        const grid = document.getElementById('questions-grid'); 
        grid.innerHTML = '';
        const addSansRetenues = document.getElementById('add-sans-retenues').checked;
        const subSansRetenues = document.getElementById('sub-sans-retenues').checked;
        jours.forEach((j, dayIdx) => {
            grid.innerHTML += `<div class="col-span-full font-black text-center py-1 mt-4 opacity-30 text-[10px] tracking-widest uppercase border-b border-white/10">‚Ä¢ ${j} ‚Ä¢</div>`;
            document.querySelectorAll(`input[data-day="${dayIdx}"]`).forEach(input => {
                for(let i=0; i<parseInt(input.value); i++) {
                    let a, b, opSign, res, type=input.dataset.op;
                    if(type==='add'||type==='sub'){
                        const min=parseInt(document.getElementById('as-min').value), max=parseInt(document.getElementById('as-max').value);
                        let attempts = 0;
                        do {
                            a=Math.floor(Math.random()*(max-min+1))+min; b=Math.floor(Math.random()*(max-min+1))+min;
                            if(type==='sub' && a<b) [a,b]=[b,a];
                            attempts++;
                            var needsCheck = (type === 'add' && addSansRetenues) || (type === 'sub' && subSansRetenues);
                        } while(needsCheck && !checkSansRetenue(a, b, type) && attempts < 500);
                        if(type==='add'){opSign='+'; res=a+b;}else{opSign='-'; res=a-b;}
                    } else if(type==='mul'){
                        a=getRandomNDigits(document.getElementById('mult-t1').value); b=getRandomNDigits(document.getElementById('mult-t2').value); opSign='x'; res=a*b;
                    } else {
                        b=Math.floor(Math.random()*(document.getElementById('div-t2').value-2+1))+2; a=Math.floor(getRandomNDigits(document.getElementById('div-t1').value)/b)*b; opSign='√∑'; res=a/b;
                    }
                    grid.innerHTML += `<div class="q-card" data-day-name="${j}"><span class="text-[13px] font-black">${a.toLocaleString('fr-FR')} ${opSign} ${b.toLocaleString('fr-FR')} =</span><span class="res-text hidden">${res.toLocaleString('fr-FR')}</span></div>`;
                }
            });
        });
        document.getElementById('setup-zone').classList.add('hidden'); document.getElementById('result-zone').classList.remove('hidden');
    }

    function retourConfiguration() {
        document.getElementById('result-zone').classList.add('hidden');
        document.getElementById('setup-zone').classList.remove('hidden');
    }

    function exportPDF() {
    const niv = document.getElementById('niveau-select').value.toUpperCase();
    
    const maintenant = new Date();
    const yyyy = maintenant.getFullYear();
    const mm = String(maintenant.getMonth() + 1).padStart(2, '0');
    const dd = String(maintenant.getDate()).padStart(2, '0');
    const dateStr = `${yyyy}-${mm}-${dd}`;
    const nomFichier = `outilsprofs_rituel_operations_${dateStr}.pdf`;

    const container = document.createElement('div');
    Object.assign(container.style, { 
        width: "175mm", margin: "0 auto", padding: "0mm", backgroundColor: "white", 
        display: "block", boxSizing: "border-box", position: "relative", top: "0"
    });

    const generateContent = (isCorrection) => {
        const titlePage = document.createElement('div');
        titlePage.innerHTML = isCorrection ? "--- CORRECTION ---" : "";
        Object.assign(titlePage.style, { textAlign: "center", fontWeight: "bold", marginBottom: "10px", fontSize: "16px", paddingTop: isCorrection ? "10px" : "0" });
        if (isCorrection) container.appendChild(titlePage);

        let currentDay = ""; 
        document.querySelectorAll('.q-card').forEach(q => {
            const day = q.getAttribute('data-day-name');
            if(day !== currentDay) {
                currentDay = day;
                const h = document.createElement('div'); 
                h.innerHTML = `‚Ä¢ ${day} ${isCorrection ? '(Correction)' : ''} ‚Ä¢`;
                Object.assign(h.style, { 
                    textAlign:"center", fontWeight:"900", padding:"4px", borderBottom:"1.5px solid black", 
                    marginBottom:"6px", marginTop: "10px", fontSize:"14px", textTransform:"uppercase", width: "100%", color: "black" 
                });
                container.appendChild(h);
                
                const currentGrid = document.createElement('div');
                Object.assign(currentGrid.style, { display:"grid", gridTemplateColumns:"1fr 1fr", gap:"6mm", marginBottom:"10px", width: "100%" });
                container.appendChild(currentGrid);
            }

            const card = document.createElement('div');
            const enonce = q.querySelector('span:first-child').innerText;
            // CORRECTION ICI : Utilisation de la classe .res-text pr√©sente dans votre script
            const reponse = q.querySelector('.res-text') ? q.querySelector('.res-text').innerText : "";
            const isDiv = enonce.includes('√∑');

            Object.assign(card.style, { border: "1px solid #e2e8f0", padding: "5px", borderRadius: "6px" });
            
            if (isCorrection) {
                card.innerHTML = `<div style="font-weight:bold; font-size:13px; color:black;">${enonce}</div>
                                  <div style="color:red; font-size:14px; margin-top:5px; font-weight:bold;">${reponse}</div>`;
            } else {
                let frameContent = isDiv ? `<div style="height:48mm"></div>` : `<div class="seyes-container"><div class="seyes-vertical-lines"></div>${Array.from({length:25}, (_,i)=>`<div class="seyes-line ${i%4===0?'line-principale':'line-interligne'}" style="top:${i*2}mm"></div>`).join('')}</div>`;
                card.innerHTML = `<div style="font-weight:bold; font-size:13px; margin-bottom:3px; color:black;">${enonce}</div>${frameContent}`;
            }

            const activeGrids = container.querySelectorAll('div[style*="display: grid"]');
            activeGrids[activeGrids.length-1].appendChild(card);
        });
    };

    generateContent(false);

    const pageBreak = document.createElement('div');
    pageBreak.style.pageBreakBefore = "always";
    container.appendChild(pageBreak);

    generateContent(true);

    const worker = html2pdf().set({ 
        margin: [10, 10, 10, 10], 
        filename: nomFichier, 
        html2canvas: { scale: 2, scrollY: 0, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } 
    }).from(container);

    if (window.Android && window.Android.savePdfFromBase64) {
        worker.outputPdf('datauristring').then(function(pdfBase64) {
            const base64String = pdfBase64.split(',')[1];
            window.Android.savePdfFromBase64(base64String, nomFichier);
        });
    } else {
        worker.save();
    }
}

    function toggleCorrection() { document.querySelectorAll('.res-text').forEach(e => e.classList.toggle('hidden')); }
    function ouvrirAide() { document.getElementById('modal-aide').style.display = 'flex'; }
    function fermerAide() { document.getElementById('modal-aide').style.display = 'none'; }

    function appliquerTheme() {
        const themePrefs = JSON.parse(localStorage.getItem('theme_tuiles')) || {};
        const colPref = themePrefs.gen || 'amber'; 
        const map = { 'red':'#ef4444','orange':'#f97316','amber':'#f59e0b','yellow':'#eab308','lime':'#84cc16','green':'#22c55e','emerald':'#10b981','teal':'#14b8a6','cyan':'#06b6d4','sky':'#0ea5e9','blue':'#3b82f6','indigo':'#6366f1','violet':'#8b5cf6','purple':'#a855f7','fuchsia':'#d946ef','pink':'#ec4899','rose':'#f43f5e','gray':'#6b7280' };
        const hexa = map[colPref]; 
        const isDarkText = ['yellow','lime','amber','cyan'].includes(colPref);
        const contrast = isDarkText ? '#000' : '#fff';
        
        document.documentElement.style.setProperty('--accent-color', hexa);
        
        [
            document.getElementById('btn-retour-header'), 
            document.getElementById('btn-retour-liste'), 
            document.getElementById('btn-aide'), 
            document.getElementById('btn-generer-main'), 
            document.getElementById('btn-export'), 
            document.getElementById('btn-fermer-aide')
        ].forEach(el => { 
            if(el){ el.style.backgroundColor = hexa; el.style.color = contrast; }
        });
        
        if(document.getElementById('titre-aide')) document.getElementById('titre-aide').style.color = hexa;
    }

    window.onload = function() { 
        appliquerPresetsNiveau(); 
        appliquerTheme(); 
    };
</script>
</body>
</html>